# 云托管域名配置指南

## 🚨 重要提示

您当前的API地址：
```
https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com/
```

**警告**：这是云托管的测试域名，仅用于测试，不能用于正式环境。

## ✅ 解决方案

### 方案1：绑定自定义域名（推荐，用于正式环境）

如果您有自己的域名，可以绑定到云托管服务：

#### 步骤1：准备域名

1. **域名要求**：
   - ✅ 已通过ICP备案（国内服务器）
   - ✅ 可以配置DNS解析
   - ✅ 支持HTTPS证书

#### 步骤2：在云托管中绑定域名

1. **进入云托管控制台**
   - 登录微信公众平台
   - 进入：**云服务** → **云开发** → **云托管**
   - 点击您的服务名称

2. **进入自定义域名页面**
   - 在服务管理页面，点击 **"自定义域名"**
   - 或从左侧菜单：**服务管理** → **自定义域名**

3. **绑定域名**
   - 点击 **"绑定域名"** 按钮
   - 输入您的域名（如：`api.yourdomain.com`）
   - 按照提示配置DNS解析（CNAME记录）
   - 等待域名验证和HTTPS证书配置完成

4. **获取绑定后的地址**
   - 绑定成功后，使用您的自定义域名
   - 例如：`https://api.yourdomain.com`

#### 步骤3：配置服务器域名

1. **在微信公众平台配置**
   - 进入：**开发** → **开发管理** → **开发设置**
   - 在 **"request合法域名"** 中添加您的自定义域名
   - 例如：`https://api.yourdomain.com`

2. **重新编译小程序**
   ```bash
   set TARO_APP_API_URL=https://api.yourdomain.com && pnpm build:weapp
   ```

---

### 方案2：暂时使用测试域名（仅用于测试）

如果您暂时没有自定义域名，可以先用测试域名进行测试：

#### 步骤1：使用测试域名配置

1. **在微信公众平台配置**
   - 进入：**开发** → **开发管理** → **开发设置**
   - 在 **"request合法域名"** 中添加测试域名：
     ```
     https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com
     ```
   - **注意**：去掉末尾的斜杠 `/`

2. **重新编译小程序**
   ```bash
   set TARO_APP_API_URL=https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com && pnpm build:weapp
   ```

#### 步骤2：测试功能

- ✅ 可以用于开发测试
- ✅ 可以用于体验版测试
- ❌ **不能用于正式发布**

#### 步骤3：正式发布前必须绑定自定义域名

正式发布前，必须：
1. 绑定自定义域名
2. 更新API地址配置
3. 重新编译小程序

---

## 📋 当前配置步骤

### 立即可以做的（使用测试域名）

1. **配置服务器域名**
   - 在您当前的页面（配置服务器域名）
   - 确认 `request合法域名` 中已添加：
     ```
     https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com
     ```
   - **重要**：去掉末尾的 `/`

2. **重新编译小程序**
   ```bash
   set TARO_APP_API_URL=https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com && pnpm build:weapp
   ```

3. **测试功能**
   - 在小程序中测试微信登录
   - 测试AI中医功能

### 正式发布前必须做的

1. **购买域名**（如果还没有）
   - 在腾讯云或其他域名服务商购买
   - 确保域名已备案

2. **绑定自定义域名**
   - 在云托管中绑定您的域名
   - 配置DNS解析

3. **更新配置**
   - 更新 `request合法域名` 为自定义域名
   - 重新编译小程序使用自定义域名

---

## 🔍 当前API地址说明

**您的API地址**：
```
https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com
```

**注意事项**：
1. ✅ 这是有效的HTTPS地址
2. ✅ 可以用于测试
3. ⚠️ 不能用于正式发布
4. ⚠️ 测试域名可能会变化

**使用建议**：
- 开发测试：可以使用
- 体验版：可以使用
- 正式发布：必须绑定自定义域名

---

## 🚀 快速开始（使用测试域名）

### 步骤1：配置服务器域名

在您当前的页面：
1. 确认 `request合法域名` 中已添加：
   ```
   https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com
   ```
2. **去掉末尾的斜杠** `/`
3. 点击"保存"或"提交"

### 步骤2：重新编译小程序

```bash
# 使用测试域名编译
set TARO_APP_API_URL=https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com && pnpm build:weapp
```

### 步骤3：测试功能

1. 在微信开发者工具中重新编译
2. 测试微信登录功能
3. 测试AI中医功能

---

## 💡 重要提示

1. **测试域名限制**：
   - 仅用于开发和测试
   - 不能用于正式发布
   - 可能会被回收或变更

2. **正式发布要求**：
   - 必须绑定自定义域名
   - 域名必须备案
   - 使用HTTPS

3. **域名格式**：
   - ✅ 正确：`https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com`
   - ❌ 错误：`https://express-w0qu-184647-5-1377481866.sh.run.tcloudbase.com/`（末尾有斜杠）

---

## 📞 需要帮助？

如果遇到问题：

1. **域名绑定问题**：查看云托管文档或联系云开发客服
2. **DNS配置问题**：联系域名服务商
3. **功能测试问题**：查看其他故障排除文档
