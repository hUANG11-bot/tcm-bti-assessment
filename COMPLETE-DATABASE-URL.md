# 完整的 DATABASE_URL 配置

## ✅ 已找到的信息

根据您提供的信息：

- ✅ **外网地址**：`sh-cdb-pvaed2ys.sql.tencentcdb.com`
- ✅ **端口**：`23371`（注意：不是默认的 3306）
- ✅ **内网地址**：`10.0.0.12:3306`（备用）

---

## 📝 组合 DATABASE_URL

### 格式

```
mysql://用户名:密码@主机地址:端口/数据库名
```

### 使用您的信息

```
mysql://root:您的密码@sh-cdb-pvaed2ys.sql.tencentcdb.com:23371/数据库名
```

---

## 🔍 还需要的信息

### 1. 用户名

**通常是**：`root`（默认管理员用户）

**如何确认**：
- 点击页面顶部的"账号管理"标签
- 查看账号列表，确认用户名

---

### 2. 密码

**重要**：
- 这是您创建数据库时设置的 root 密码
- 密码不会显示在控制台
- 如果忘记，可以在"账号管理"中重置

**如何重置**（如果忘记）：
1. 点击"账号管理"标签
2. 找到 root 账号
3. 点击"重置密码"或"修改密码"
4. 设置新密码并记住

---

### 3. 数据库名

**需要创建**（如果还没创建）：

1. **点击页面顶部的"数据库管理"标签**
2. **查看已创建的数据库**
3. **如果还没有创建**：
   - 点击"创建数据库"按钮
   - 输入数据库名：`tcm_bti_assessment`（或您喜欢的名称）
   - 选择字符集：`UTF8MB4`（推荐）
   - 确认创建

---

## 📋 完整示例

假设：
- 用户名：`root`
- 密码：`MyP@ssw0rd123`（您的实际密码）
- 数据库名：`tcm_bti_assessment`

**完整的 DATABASE_URL**：
```
mysql://root:MyP@ssw0rd123@sh-cdb-pvaed2ys.sql.tencentcdb.com:23371/tcm_bti_assessment
```

---

## ⚠️ 重要注意事项

### 1. 端口是 23371（不是 3306）

**注意**：您的端口是 `23371`，不是默认的 `3306`。

**在连接字符串中必须使用**：`23371`

---

### 2. 密码中的特殊字符

如果密码包含特殊字符（如 `@`、`:`、`/` 等），需要进行 URL 编码：

- `@` → `%40`
- `:` → `%3A`
- `/` → `%2F`
- `#` → `%23`
- `?` → `%3F`
- `&` → `%26`

**示例**：
```
密码：p@ssw:rd
编码后：p%40ssw%3Ard
连接字符串：mysql://root:p%40ssw%3Ard@sh-cdb-pvaed2ys.sql.tencentcdb.com:23371/tcm_bti_assessment
```

---

### 3. 数据库必须存在

在配置 `DATABASE_URL` 前，确保：

1. **数据库已创建**：
   - 在"数据库管理"中创建数据库
   - 例如：`tcm_bti_assessment`

2. **数据库名称正确**：
   - 在连接字符串中使用正确的数据库名

---

### 4. 安全组和白名单

确保：

1. **安全组规则**：
   - 允许微信云托管访问数据库端口 `23371`

2. **白名单配置**：
   - 在数据库实例详情页
   - 找到"安全组"或"访问控制"
   - 添加微信云托管的 IP 地址
   - 或暂时允许所有 IP（仅用于测试）

---

## 🚀 在微信云托管中配置

### 步骤1：进入服务设置

1. **微信云托管控制台**
2. **服务管理** → **服务列表**
3. **点击您的服务名称**
4. **点击"服务设置"标签**

---

### 步骤2：添加环境变量

1. **找到"环境变量"部分**
2. **点击"添加环境变量"**
3. **填写信息**：
   - **变量名**：`DATABASE_URL`
   - **变量值**：完整的连接字符串
   - **示例**：
     ```
     mysql://root:您的密码@sh-cdb-pvaed2ys.sql.tencentcdb.com:23371/tcm_bti_assessment
     ```
4. **保存配置**

---

### 步骤3：重新部署服务

1. **返回"部署发布"页面**
2. **点击"发布"按钮**
3. **等待部署完成**

---

## 🎯 现在请

### 步骤1：确认所有信息

1. **用户名**：
   - 点击"账号管理"标签
   - 确认用户名（通常是 `root`）

2. **密码**：
   - 回忆创建数据库时设置的密码
   - 如果忘记，在"账号管理"中重置

3. **数据库名**：
   - 点击"数据库管理"标签
   - 查看已创建的数据库
   - 如果还没创建，创建数据库（如：`tcm_bti_assessment`）

---

### 步骤2：组合连接字符串

使用以下格式：
```
mysql://用户名:密码@sh-cdb-pvaed2ys.sql.tencentcdb.com:23371/数据库名
```

**示例**（请替换为您的实际信息）：
```
mysql://root:您的密码@sh-cdb-pvaed2ys.sql.tencentcdb.com:23371/tcm_bti_assessment
```

---

### 步骤3：在微信云托管中配置

1. **进入微信云托管控制台**
2. **服务管理** → **服务列表** → **您的服务** → **服务设置**
3. **添加环境变量**：
   - 变量名：`DATABASE_URL`
   - 变量值：上面组合的连接字符串
4. **保存配置**
5. **重新部署服务**

---

## 📋 信息总结

### 已确认的信息

- ✅ **外网地址**：`sh-cdb-pvaed2ys.sql.tencentcdb.com`
- ✅ **端口**：`23371`
- ✅ **内网地址**：`10.0.0.12:3306`（备用）

### 需要确认的信息

- [ ] **用户名**：通常是 `root`（在"账号管理"中确认）
- [ ] **密码**：您创建数据库时设置的密码
- [ ] **数据库名**：需要创建（如：`tcm_bti_assessment`）

---

## 💡 提示

1. **端口是 23371**：
   - 不是默认的 3306
   - 在连接字符串中必须使用 `23371`

2. **密码编码**：
   - 如果密码包含特殊字符，记得进行 URL 编码

3. **数据库必须先创建**：
   - 在"数据库管理"中创建数据库
   - 然后再配置 `DATABASE_URL`

---

## 🎯 现在请

1. **确认用户名**（在"账号管理"中查看）

2. **确认或重置密码**（如果忘记）

3. **创建数据库**（在"数据库管理"中创建，如：`tcm_bti_assessment`）

4. **组合完整的 DATABASE_URL**：
   ```
   mysql://root:您的密码@sh-cdb-pvaed2ys.sql.tencentcdb.com:23371/tcm_bti_assessment
   ```

5. **在微信云托管中配置**：
   - 进入"服务设置"
   - 添加 `DATABASE_URL` 环境变量
   - 保存并重新部署

**完成后告诉我结果！**
