# 数据库创建配置指南

## 📋 您当前在：创建 MySQL 数据库实例

根据您看到的页面，这是**步骤2：设置网络和数据库**。以下是推荐配置：

---

## 🌐 网络配置（步骤2）

### 1. 网络（VPC）

**当前显示**：`Default-VPC (默认)`

**建议**：
- ✅ **保持默认**：使用 `Default-VPC (默认)`
- 如果提示需要选择子网，选择一个可用的子网

**如果子网显示红色（必填）**：
- 点击下拉菜单
- 选择一个可用的子网
- 如果没有可用子网，点击提示中的"新建子网"链接创建

---

### 2. 自定义端口

**当前显示**：`3306`

**建议**：
- ✅ **保持 `3306`**（MySQL 默认端口）
- 这是标准配置，不需要修改

---

### 3. 安全组（重要）

**当前状态**：已选择安全组 (共0条)

**必须操作**：
1. **点击"新建安全组"链接**
2. **或选择一个现有的安全组**

**安全组规则要求**：
- 允许**出站**（出站）连接到数据库端口 `3306`
- 允许微信云托管服务访问数据库

**如果创建新安全组**：
- 名称：如 `mysql-access`
- 规则：允许出站 TCP 端口 3306
- 或暂时允许所有出站流量（仅用于测试）

---

### 4. 指定项目

**当前显示**：`默认项目`

**建议**：
- ✅ **保持默认**即可

---

### 5. 标签（可选）

**建议**：
- 可以跳过，或添加一个标签便于管理
- 例如：`环境: 生产` 或 `用途: 微信小程序`

---

## 🗄️ 数据库设置（步骤3）

### 1. 实例名

**建议**：
- ✅ 选择"**立即命名**"
- 输入一个有意义的名字，如：`tcm-bti-mysql` 或 `wechat-app-db`

---

### 2. 数据复制方式

**当前选择**：`半同步复制`

**建议**：
- ✅ **保持默认**（半同步复制）
- 这是推荐的配置，平衡了性能和可靠性

---

### 3. 参数模板

**当前选择**：`[默认]高稳定性模板 (推荐)`

**建议**：
- ✅ **保持默认**即可
- 这个模板适合大多数应用场景

---

### 4. 字符集（重要）

**当前选择**：`UTF8`

**建议**：
- ⚠️ **改为 `UTF8MB4`**（推荐）
- `UTF8MB4` 完全支持所有 Unicode 字符，包括 emoji
- 如果您的应用需要支持 emoji 或特殊字符，必须选择 `UTF8MB4`

**如何修改**：
1. 点击字符集下拉菜单
2. 选择 `UTF8MB4`

---

### 5. 排序规则

**当前选择**：`UTF8_GENERAL_CI`

**建议**：
- 如果选择了 `UTF8MB4`，选择 `UTF8MB4_GENERAL_CI`
- 如果保持 `UTF8`，保持 `UTF8_GENERAL_CI`

---

### 6. 表名大小写敏感

**当前选择**：`关闭`

**建议**：
- ✅ **保持"关闭"**（`lower_case_table_names=1`）
- ⚠️ **注意**：MySQL 8.0 中此设置创建后无法更改
- 关闭后，`Users` 和 `users` 会被视为同一个表，避免大小写问题

---

### 7. 密码复杂度

**当前选择**：`关闭`

**建议**：
- ✅ **改为"开启"**（推荐用于生产环境）
- 强制使用强密码，提高安全性

---

### 8. root密码（最重要）

**当前选择**：`现在设置`

**必须操作**：
1. ✅ **保持"现在设置"**
2. **输入一个强密码**：
   - 至少 8 个字符
   - 包含大小写字母、数字和特殊字符
   - **重要**：请记住这个密码，稍后需要用到！

**密码示例格式**（不要使用这个，只是格式参考）：
```
MyP@ssw0rd123!
```

**安全提示**：
- 不要使用简单密码（如 `123456`、`password`）
- 将密码保存在安全的地方
- 稍后配置 `DATABASE_URL` 时需要用到

---

## 📝 推荐配置总结

### 网络配置
- ✅ VPC：`Default-VPC (默认)`
- ✅ 子网：选择一个可用子网（或新建）
- ✅ 端口：`3306`
- ⚠️ **安全组**：必须创建或选择一个（允许出站 3306）
- ✅ 项目：`默认项目`

### 数据库配置
- ✅ 实例名：立即命名（如 `tcm-bti-mysql`）
- ✅ 数据复制：`半同步复制`（默认）
- ✅ 参数模板：`[默认]高稳定性模板`（默认）
- ⚠️ **字符集**：改为 `UTF8MB4`（推荐）
- ✅ 排序规则：`UTF8MB4_GENERAL_CI`（如果选择 UTF8MB4）
- ✅ 表名大小写：`关闭`（默认）
- ✅ 密码复杂度：`开启`（推荐）
- ⚠️ **root密码**：现在设置（必须记住密码！）

---

## 🚀 下一步操作

### 步骤1：完成当前配置

1. **配置网络**：
   - 选择子网（如果提示）
   - 创建或选择安全组

2. **配置数据库**：
   - 输入实例名
   - 改为 `UTF8MB4` 字符集
   - 开启密码复杂度
   - **设置并记住 root 密码**

3. **点击"下一步"或"确认"**

---

### 步骤2：等待数据库创建

- 创建过程可能需要几分钟
- 创建完成后，您会看到数据库实例

---

### 步骤3：获取连接信息

创建完成后，在数据库实例详情页：

1. **查看连接信息**：
   - 主机地址（如：`cdb-xxxxx.sql.tencentcdb.com`）
   - 端口（通常是 `3306`）
   - 用户名（`root`）
   - 密码（您刚才设置的）

2. **创建数据库**：
   - 在实例详情页
   - 点击"数据库管理"
   - 创建数据库（如：`tcm_bti_assessment`）

3. **配置白名单**（重要）：
   - 在"安全组"或"访问控制"中
   - 添加微信云托管的 IP 地址
   - 或暂时允许所有 IP（仅用于测试）

---

### 步骤4：组合连接字符串

使用以下格式：
```
mysql://root:您的密码@主机地址:3306/数据库名
```

**示例**：
```
mysql://root:MyP@ssw0rd123@cdb-abc123.sql.tencentcdb.com:3306/tcm_bti_assessment
```

---

### 步骤5：在微信云托管中配置

1. **进入微信云托管控制台**
2. **服务管理** → **服务列表** → **您的服务** → **服务设置**
3. **添加环境变量**：
   - 变量名：`DATABASE_URL`
   - 变量值：上面组合的连接字符串
4. **保存并重新部署**

---

## ⚠️ 重要提醒

### 密码安全
- ✅ 使用强密码
- ✅ 记住密码（稍后配置需要）
- ❌ 不要使用简单密码

### 字符集选择
- ✅ 推荐使用 `UTF8MB4`（支持 emoji）
- ⚠️ 如果选择 `UTF8`，某些特殊字符可能无法正确存储

### 表名大小写
- ✅ 推荐"关闭"（避免大小写问题）
- ⚠️ MySQL 8.0 中创建后无法更改

### 安全组配置
- ⚠️ **必须配置**，否则无法连接数据库
- 确保允许出站端口 3306

---

## 🎯 现在请

1. **完成网络配置**：
   - 选择子网
   - 创建或选择安全组

2. **完成数据库配置**：
   - 输入实例名
   - 改为 `UTF8MB4` 字符集
   - 开启密码复杂度
   - **设置并记住 root 密码**

3. **点击"下一步"或"确认"创建数据库**

4. **创建完成后告诉我**，我会帮您配置连接字符串

---

## 💡 提示

- 如果遇到任何问题，告诉我具体在哪一步
- 创建过程可能需要几分钟，请耐心等待
- 记住 root 密码，稍后配置 `DATABASE_URL` 时需要

**完成后告诉我结果！**
