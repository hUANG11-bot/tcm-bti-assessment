# 如何查看和配置 DATABASE_URL

## 📋 从腾讯云控制台获取数据库连接信息

根据您看到的数据库实例列表，您已经有了数据库实例 `cdb-pvaed2ys`。

---

## 🔍 步骤1：获取数据库连接信息

### 1. 进入数据库实例详情页

1. **在腾讯云控制台的 MySQL 实例列表中**
2. **点击您的数据库实例名称**（`cdb-pvaed2ys`）
3. **进入实例详情页**

---

### 2. 查看连接信息

在实例详情页，找到以下信息：

#### 必需信息

1. **主机地址（Host）**
   - 位置：通常在"连接信息"或"基本信息"中
   - 可能显示为：
     - **内网地址**：如 `10.0.0.12`（仅内网访问）
     - **外网地址**：如 `cdb-xxxxx.sql.tencentcdb.com`（外网访问）
   - ⚠️ **注意**：微信云托管通常需要**外网地址**，如果只有内网地址，需要：
     - 开启外网访问
     - 或确保微信云托管和数据库在同一 VPC 内

2. **端口（Port）**
   - 通常是 `3306`（MySQL 默认端口）
   - 从您的图片中看到：`3306`

3. **用户名（Username）**
   - 通常是 `root`（默认管理员用户）
   - 或您创建的其他用户名

4. **密码（Password）**
   - 这是您在创建数据库时设置的 root 密码
   - ⚠️ **重要**：密码不会显示在控制台，需要您回忆或重置

5. **数据库名（Database）**
   - 这是您在数据库实例内创建的数据库名称
   - 例如：`tcm_bti_assessment`
   - ⚠️ **注意**：需要先在数据库实例中创建数据库

---

## 📝 步骤2：组合 DATABASE_URL

### 格式

```
mysql://用户名:密码@主机地址:端口/数据库名
```

### 示例

根据您的情况：

```
mysql://root:您的密码@10.0.0.12:3306/tcm_bti_assessment
```

**但注意**：
- 如果 `10.0.0.12` 是内网地址，微信云托管可能无法访问
- 需要查看是否有外网地址，或配置网络访问

---

## 🔧 步骤3：在微信云托管中配置

### 1. 进入服务设置

1. **微信云托管控制台**
2. **服务管理** → **服务列表**
3. **点击您的服务名称**
4. **点击"服务设置"标签**

---

### 2. 添加环境变量

1. **找到"环境变量"部分**
2. **点击"添加环境变量"**
3. **填写信息**：
   - **变量名**：`DATABASE_URL`
   - **变量值**：上面组合的连接字符串
   - **示例**：
     ```
     mysql://root:MyP@ssw0rd123@10.0.0.12:3306/tcm_bti_assessment
     ```
4. **保存配置**

---

### 3. 重新部署服务

1. **返回"部署发布"页面**
2. **点击"发布"按钮**
3. **等待部署完成**

---

## ⚠️ 重要注意事项

### 1. 内网地址 vs 外网地址

**从您的图片看到**：内网地址是 `10.0.0.12:3306`

**问题**：
- 如果这是内网地址，微信云托管可能无法直接访问
- 需要外网地址或配置网络访问

**解决**：
1. **查看是否有外网地址**：
   - 在数据库实例详情页
   - 查看"连接信息"
   - 如果有"外网地址"，使用外网地址

2. **如果没有外网地址**：
   - 在数据库实例详情页
   - 找到"外网"或"公网访问"选项
   - 开启外网访问（可能需要配置安全组）

3. **或使用内网地址**（如果微信云托管和数据库在同一 VPC）：
   - 确保微信云托管服务在同一个 VPC 内
   - 使用内网地址：`10.0.0.12`

---

### 2. 密码中的特殊字符

如果密码包含特殊字符（如 `@`、`:`、`/` 等），需要进行 URL 编码：

- `@` → `%40`
- `:` → `%3A`
- `/` → `%2F`
- `#` → `%23`
- `?` → `%3F`
- `&` → `%26`

**示例**：
```
密码：p@ssw:rd
编码后：p%40ssw%3Ard
连接字符串：mysql://root:p%40ssw%3Ard@10.0.0.12:3306/db
```

---

### 3. 数据库必须存在

在配置 `DATABASE_URL` 前，确保：

1. **数据库已创建**：
   - 在数据库实例详情页
   - 点击"数据库管理"
   - 创建数据库（如：`tcm_bti_assessment`）

2. **数据库名称正确**：
   - 在连接字符串中使用正确的数据库名

---

### 4. 安全组和白名单

确保：

1. **安全组规则**：
   - 允许微信云托管访问数据库端口 `3306`

2. **白名单配置**：
   - 在数据库实例详情页
   - 找到"安全组"或"访问控制"
   - 添加微信云托管的 IP 地址
   - 或暂时允许所有 IP（仅用于测试）

---

## 🎯 现在请

### 步骤1：获取完整连接信息

1. **进入数据库实例详情页**：
   - 点击数据库实例名称 `cdb-pvaed2ys`

2. **查看连接信息**：
   - 找到主机地址（内网或外网）
   - 确认端口（通常是 3306）
   - 确认用户名（通常是 root）
   - 回忆密码（创建时设置的）

3. **创建数据库**（如果还没创建）：
   - 在实例详情页
   - 点击"数据库管理"
   - 创建数据库（如：`tcm_bti_assessment`）

---

### 步骤2：组合连接字符串

使用以下格式：
```
mysql://root:您的密码@主机地址:3306/数据库名
```

**示例**（使用内网地址）：
```
mysql://root:MyP@ssw0rd123@10.0.0.12:3306/tcm_bti_assessment
```

**示例**（使用外网地址）：
```
mysql://root:MyP@ssw0rd123@cdb-xxxxx.sql.tencentcdb.com:3306/tcm_bti_assessment
```

---

### 步骤3：在微信云托管中配置

1. **进入微信云托管控制台**
2. **服务管理** → **服务列表** → **您的服务** → **服务设置**
3. **添加环境变量**：
   - 变量名：`DATABASE_URL`
   - 变量值：上面组合的连接字符串
4. **保存配置**
5. **重新部署服务**

---

## 💡 提示

1. **如果只有内网地址**：
   - 检查是否有外网地址选项
   - 或确保微信云托管和数据库在同一 VPC

2. **如果忘记密码**：
   - 在数据库实例详情页
   - 找到"账号管理"或"重置密码"
   - 重置 root 密码

3. **如果连接失败**：
   - 检查安全组规则
   - 检查白名单配置
   - 检查连接字符串格式

---

## 🔍 需要的信息

为了帮您组合正确的 `DATABASE_URL`，请告诉我：

1. **主机地址**：
   - 是内网地址（`10.0.0.12`）还是外网地址？
   - 如果有外网地址，是什么？

2. **密码**：
   - 您记得创建数据库时设置的密码吗？
   - 如果忘记，需要重置

3. **数据库名**：
   - 您已经创建了数据库吗？
   - 数据库名称是什么？

**告诉我这些信息，我可以帮您组合正确的 `DATABASE_URL`！**
