# 服务设置指南

## 📋 当前设置评估

根据您提供的服务设置页面，以下是评估和建议：

---

## ✅ 基本设置（正确）

### 1. **容器规格**
- **CPU：1核** ✅ 合理
- **内存：2G** ✅ 合理（对于 Node.js 应用足够）

### 2. **实例副本数**
- **最小：0** ✅ 可以（节省成本）
- **最大：5** ✅ 合理

### 3. **扩缩容条件**
- **CPU使用率 ≥ 60%** ✅ 合理

### 4. **日志采集路径**
- **stdout** ✅ 正确（会收集所有控制台输出）

---

## ⚠️ 需要配置：环境变量

**重要**：您的环境变量列表是空的，但应用需要以下环境变量才能正常运行：

### 必需的环境变量

1. **微信小程序配置**：
   ```
   WX_APPID=wx9811089020af2ae3
   WX_SECRET=您的微信小程序密钥
   ```

2. **JWT 密钥**：
   ```
   JWT_SECRET=您的JWT密钥（用于会话加密）
   ```

3. **数据库连接**：
   ```
   DATABASE_URL=您的数据库连接字符串
   ```

4. **AI 服务配置**：
   ```
   AI_PROVIDER=deepseek
   AI_API_KEY=您的DeepSeek API密钥
   AI_API_URL=https://api.deepseek.com
   ```

5. **端口（可选，默认3000）**：
   ```
   PORT=3000
   ```

6. **环境（可选，默认production）**：
   ```
   NODE_ENV=production
   ```

---

## 🔧 如何配置环境变量

1. 在"环境变量"部分，点击 **"+"** 按钮
2. 为每个环境变量添加：
   - **Key**：变量名（如 `WX_APPID`）
   - **Value**：变量值（如 `wx9811089020af2ae3`）
3. 添加完所有环境变量后，点击 **"保存"**

---

## ⚠️ 重要提醒

### 1. 构建失败问题

**当前设置页面是运行时配置，不会影响 Docker 镜像构建失败的问题。**

如果构建仍然失败（`check_build_image : fail`），您需要：
1. 查看**构建日志**（在"部署发布"页面）
2. 找到失败的具体原因
3. 根据错误信息修复 Dockerfile

### 2. 公网域名警告

页面显示：
> "公网域名仅能支持测试使用,请勿用于线上生产"

**建议**：
- 如果用于生产环境，请绑定自定义域名（如 `api.er1.store`）
- 参考之前的 `BIND-CUSTOM-DOMAIN.md` 文档

### 3. 内网访问

当前内网访问是关闭的。如果您的应用需要：
- 与其他云服务通信
- 访问云数据库
- 使用云函数

可以开启内网访问。

---

## 📝 配置步骤

### 步骤1：配置环境变量

1. 在"环境变量"部分，逐个添加必需的环境变量
2. 点击 **"保存"**

### 步骤2：确认端口

确保 `PORT` 环境变量设置为 `3000`（或与 Dockerfile 中的 `EXPOSE 3000` 一致）

### 步骤3：保存设置

点击页面底部的 **"保存"** 按钮

---

## 🚨 如果构建仍然失败

**这些运行时设置不会解决构建失败的问题。**

如果 Docker 镜像构建仍然失败，请：

1. **进入"部署发布"页面**
2. **找到失败的版本**（如：`zhongyiti-014`）
3. **点击版本名称或"查看详情"**
4. **查看"构建日志"**
5. **复制完整的构建日志**，特别是：
   - `npm install` 的输出
   - 任何错误信息（`ERROR`、`FAILED`、`npm ERR!`）

---

## ✅ 总结

**当前设置**：
- ✅ 容器规格合理
- ✅ 扩缩容配置合理
- ✅ 日志采集正确
- ⚠️ **需要配置环境变量**（重要！）

**下一步**：
1. 配置所有必需的环境变量
2. 保存设置
3. 如果构建失败，查看构建日志并提供给我

---

## 📞 需要帮助？

如果配置环境变量时遇到问题，或者构建仍然失败，请：
1. 提供构建日志（如果失败）
2. 告诉我具体的问题
3. 我可以进一步协助
