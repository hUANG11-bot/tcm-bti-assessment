# 启动后端服务器

## ❌ 当前问题

小程序显示：`无法连接到服务器 https://er1.store`

## 🔍 问题原因

后端服务器没有运行。小程序需要连接到后端 API 才能正常工作。

---

## ✅ 解决方案

### 步骤1：启动后端服务器

**打开一个新的 PowerShell 窗口**（保持微信开发者工具和编译窗口打开），然后运行：

```powershell
cd d:\tcm-bti-assessment
pnpm dev
```

这会：
- 启动后端服务器
- 默认运行在 `http://localhost:3000`
- 开启监听模式（代码变化时自动重启）

### 步骤2：确认后端服务运行

**等待几秒钟，应该看到类似输出**：

```
Server running on http://localhost:3000
```

或者：

```
Server started successfully
```

### 步骤3：在微信开发者工具中关闭域名校验

**如果还没有关闭域名校验**：

1. 在微信开发者工具中，点击右上角的"详情"按钮
2. 切换到"本地设置"标签
3. ✅ **勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"**
4. 关闭设置窗口

### 步骤4：重新编译小程序

**在微信开发者工具中**：
1. 点击"编译"按钮
2. 或者点击"编译"旁边的下拉箭头，选择"清除缓存" → "清除所有缓存"，然后重新编译

---

## 📋 完整操作流程

### 1. 启动后端服务器（新 PowerShell 窗口）

```powershell
cd d:\tcm-bti-assessment
pnpm dev
```

### 2. 确认后端运行

等待看到服务器启动成功的消息。

### 3. 关闭域名校验（微信开发者工具）

- 详情 → 本地设置 → ✅ 勾选"不校验合法域名"

### 4. 重新编译小程序（微信开发者工具）

- 点击"编译"按钮

---

## ⚠️ 重要提示

### 需要同时运行两个进程

1. **后端服务器**：`pnpm dev`（在一个 PowerShell 窗口中）
2. **小程序编译**：`pnpm dev:weapp`（在另一个 PowerShell 窗口中）

### 如果使用生产域名

如果您的后端已经部署到 `https://er1.store`，那么：
- 不需要运行 `pnpm dev`
- 只需要关闭域名校验
- 确保 `https://er1.store` 可以正常访问

---

## 🔍 检查后端是否运行

### 方法1：查看 PowerShell 输出

如果看到服务器启动消息，说明后端正在运行。

### 方法2：测试 API 连接

**在浏览器中访问**：

```
http://localhost:3000/api/trpc/system.health
```

如果返回 JSON 数据，说明后端正常运行。

---

## 🚀 立即操作

**打开一个新的 PowerShell 窗口，运行**：

```powershell
cd d:\tcm-bti-assessment
pnpm dev
```

**然后**：
1. 等待后端启动（看到服务器运行消息）
2. 在微信开发者工具中关闭域名校验（如果还没关闭）
3. 重新编译小程序

---

## 💡 提示

- **保持两个 PowerShell 窗口打开**：
  - 一个运行 `pnpm dev`（后端服务器）
  - 一个运行 `pnpm dev:weapp`（小程序编译）
- **如果后端启动失败**：检查 `.env` 文件中的配置是否正确
- **如果仍然无法连接**：检查防火墙是否阻止了端口 3000

---

**请先启动后端服务器，然后告诉我结果！**
