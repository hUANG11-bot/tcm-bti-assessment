# 更新为自定义域名 er1.store

## ✅ 已完成的更新

1. **更新了所有 API 地址**：
   - `src/lib/trpc.ts` ✅ → `https://er1.store`
   - `src/pages/profile/index.tsx` ✅ → `https://er1.store`
   - `src/pages/admin/index.tsx` ✅ → `https://er1.store`
   - `config/index.js` ✅ → 生产环境使用 `https://er1.store`

2. **已重新编译**：小程序已使用新的自定义域名重新编译

---

## 📝 下一步操作

### 步骤1：在微信公众平台配置合法域名（重要）

**必须配置**，否则小程序无法访问自定义域名。

1. **登录微信公众平台**：https://mp.weixin.qq.com
2. **进入**：**开发** → **开发管理** → **开发设置**
3. **找到"服务器域名"部分**
4. **在"request合法域名"中添加**：
   ```
   https://er1.store
   ```
5. **保存配置**

**注意**：
- 域名必须使用 HTTPS
- 域名必须通过 ICP 备案（国内服务器）
- 配置后可能需要等待几分钟生效

---

### 步骤2：在微信开发者工具中清除缓存

1. **在微信开发者工具中**
2. **点击"编译"按钮旁边的下拉箭头**
3. **选择"清除缓存"**
4. **选择"清除所有缓存"**

---

### 步骤3：重新加载小程序

1. **点击"编译"按钮**（或按 `Ctrl+B`）
2. **等待编译完成**

---

### 步骤4：验证配置

1. **打开"调试器"**（点击工具栏的"调试器"按钮）
2. **切换到"Console"标签**
3. **查看日志**，应该看到：
   ```
   [tRPC] API Base URL: https://er1.store
   ```

---

### 步骤5：测试连接

1. **在小程序中测试功能**：
   - 尝试使用 AI 咨询功能
   - 尝试登录功能
   - 查看是否能正常连接

---

## 🔍 验证方法

### 方法1：查看控制台日志

在微信开发者工具的 Console 中，应该看到：
```
[tRPC] API Base URL: https://er1.store
```

---

### 方法2：检查网络请求

1. **打开"调试器" → "Network"标签**
2. **在小程序中触发一个 API 请求**
3. **查看请求的 URL**，应该指向：
   ```
   https://er1.store/api/trpc/...
   ```

---

## ⚠️ 重要提示

### 关于域名配置

- **必须在微信公众平台配置**：这是必需的步骤
- **域名必须备案**：国内服务器需要 ICP 备案
- **使用 HTTPS**：小程序要求使用 HTTPS

---

### 关于缓存

- **必须清除缓存**：修改配置后必须清除缓存
- **重新编译**：清除缓存后必须重新编译

---

## 📋 当前配置

### API 地址配置

**开发环境**（本地开发）：
- 使用：`http://localhost:3000`

**生产环境**（小程序发布）：
- 使用：`https://er1.store`

---

### 自定义域名信息

- **域名**：`er1.store`
- **状态**：正常
- **HTTPS**：已开启
- **CNAME**：`tcbgw-u8ziub5ktggvk358.yezmz5t8191eg4r3-17.tencentcloudbase.com`

---

## 🎯 现在请

1. **在微信公众平台配置合法域名**：
   - 添加 `https://er1.store` 到 request合法域名

2. **在微信开发者工具中清除缓存**

3. **重新编译小程序**

4. **查看控制台日志**：
   - 确认 API 地址是 `https://er1.store`

5. **测试连接**：
   - 尝试使用 AI 功能
   - 查看是否能正常连接

6. **如果还有问题**：
   - 查看控制台错误信息
   - 告诉我具体的错误

---

## 💡 提示

- **域名已绑定**：自定义域名 `er1.store` 已成功绑定
- **代码已更新**：所有 API 地址已更新为自定义域名
- **已重新编译**：小程序已使用新域名重新编译
- **需要配置合法域名**：这是关键步骤，不要跳过

**请按照上述步骤操作，特别是配置合法域名，然后告诉我结果！**
