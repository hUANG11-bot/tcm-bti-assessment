/*! For license information please see index.js.LICENSE.txt */
"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[988],{7299:function(e,n,t){var r=t(3897),s=t(758),a=t(5490),i=t(1093),o=t.n(i),c=t(7011),l=t(486),u=t(4476),d=t(6070);function h(e){return p(e)||f(e)||S(e)||m()}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function p(e){if(Array.isArray(e))return N(e)}function j(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",s=t.toStringTag||"@@toStringTag";function a(t,r,s,a){var c=r&&r.prototype instanceof o?r:o,l=Object.create(c.prototype);return x(l,"_invoke",function(t,r,s){var a,o,c,l=0,u=s||[],d=!1,h={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(n,t){return a=n,o=0,c=e,h.n=t,i}};function m(t,r){for(o=t,c=r,n=0;!d&&l&&!s&&n<u.length;n++){var s,a=u[n],m=h.p,f=a[2];t>3?(s=f===r)&&(c=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=m&&((s=t<2&&m<a[1])?(o=0,h.v=r,h.n=a[1]):m<f&&(s=t<3||a[0]>r||r>f)&&(a[4]=t,a[5]=r,h.n=f,o=0))}if(s||t>1)return i;throw d=!0,r}return function(s,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),o=u,c=f;(n=o<2?e:c)||!d;){a||(o?o<3?(o>1&&(h.n=-1),m(o,c)):h.n=c:h.v=c);try{if(l=2,a){if(o||(s="next"),n=a[s]){if(!(n=n.call(a,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,o<2&&(o=0)}else 1===o&&(n=a["return"])&&n.call(a),o<2&&(c=TypeError("The iterator does not provide a '"+s+"' method"),o=1);a=e}else if((n=(d=h.n<0)?c:t.call(r,h))!==i)break}catch(n){a=e,o=1,c=n}finally{l=1}}return{value:n,done:d}}}(t,s,a),!0),l}var i={};function o(){}function c(){}function l(){}n=Object.getPrototypeOf;var u=[][r]?n(n([][r]())):(x(n={},r,function(){return this}),n),d=l.prototype=o.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,x(e,s,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=l,x(d,"constructor",l),x(l,"constructor",c),c.displayName="GeneratorFunction",x(l,s,"GeneratorFunction"),x(d),x(d,s,"Generator"),x(d,r,function(){return this}),x(d,"toString",function(){return"[object Generator]"}),(j=function(){return{w:a,m:h}})()}function x(e,n,t,r){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}x=function(e,n,t,r){function a(n,t){x(e,n,function(e){return this._invoke(n,t,e)})}n?s?s(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},x(e,n,t,r)}function v(e,n,t,r,s,a,i){try{var o=e[a](i),c=o.value}catch(e){return void t(e)}o.done?n(c):Promise.resolve(c).then(r,s)}function y(e){return function(){var n=this,t=arguments;return new Promise(function(r,s){var a=e.apply(n,t);function i(e){v(a,r,s,i,o,"next",e)}function o(e){v(a,r,s,i,o,"throw",e)}i(void 0)})}}function g(e,n){return T(e)||w(e,n)||S(e,n)||b()}function b(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function S(e,n){if(e){if("string"==typeof e)return N(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?N(e,n):void 0}}function N(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function w(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,s,a,i,o=[],c=!0,l=!1;try{if(a=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=a.call(t)).done)&&(o.push(r.value),o.length!==n);c=!0);}catch(e){l=!0,s=e}finally{try{if(!c&&null!=t["return"]&&(i=t["return"](),Object(i)!==i))return}finally{if(l)throw s}}return o}}function T(e){if(Array.isArray(e))return e}function E(){var e=(0,s.useState)(!1),n=g(e,2),t=n[0],r=n[1],i=(0,s.useState)(null),m=g(i,2),f=m[0],p=m[1],x=(0,s.useState)(!0),v=g(x,2),b=v[0],S=v[1];(0,s.useEffect)(function(){var e=function(){var e=y(j().m(function e(){var n,t,s;return j().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,n="https://er1.store",e.n=1,o().request({url:"".concat(n,"/api/admin/check"),method:"GET"});case 1:t=e.v,200===t.statusCode&&t.data.isAuthenticated?(r(!0),p(t.data.admin)):(r(!1),o().redirectTo({url:"/pages/admin/login/index"})),e.n=3;break;case 2:e.p=2,s=e.v,console.error("Check auth failed:",s),r(!1),o().redirectTo({url:"/pages/admin/login/index"});case 3:return e.p=3,S(!1),e.f(3);case 4:return e.a(2)}},e,null,[[0,2,3,4]])}));return function(){return e.apply(this,arguments)}}();e()},[]);var N=c.id.assessment.stats.useQuery(void 0,{enabled:t,retry:!1}),w=N.data,T=N.isLoading,E=(N.refetch,c.id.assessment.all.useQuery(void 0,{enabled:t,retry:!1})),O=E.data,A=E.isLoading,Y=(E.refetch,function(){var e=y(j().m(function e(){var n,t;return j().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,n="https://er1.store",e.n=1,o().request({url:"".concat(n,"/api/admin/logout"),method:"POST"});case 1:o().showToast({title:"\u5df2\u9000\u51fa\u767b\u5f55",icon:"success"}),o().redirectTo({url:"/pages/admin/login/index"}),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Logout failed:",t),o().showToast({title:"\u9000\u51fa\u5931\u8d25",icon:"none"});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}());if(b||T||A)return(0,d.jsx)(a.Ss,{className:"admin-page",children:(0,d.jsx)(a.Ss,{className:"loading-state",children:(0,d.jsx)(a.EY,{className:"loading-text",children:"\u52a0\u8f7d\u4e2d..."})})});if(!t)return(0,d.jsx)(a.Ss,{className:"admin-page",children:(0,d.jsxs)(a.Ss,{className:"empty-state",children:[(0,d.jsx)(a.EY,{className:"empty-title",children:"\u8bf7\u5148\u767b\u5f55"}),(0,d.jsx)(u.$,{onClick:function(){return o().redirectTo({url:"/pages/admin/login/index"})},children:"\u524d\u5f80\u767b\u5f55"})]})});var Z=function(){if(O&&0!==O.length){var e=["ID","\u7528\u6237ID","\u5e74\u9f84","\u6027\u522b","\u4e3b\u8981\u4f53\u8d28","\u6b21\u8981\u4f53\u8d28","\u521b\u5efa\u65f6\u95f4"],n=O.map(function(e){return[e.id,e.userId||"-",e.age,"male"===e.gender?"\u7537":"\u5973",e.primaryType,e.secondaryType||"-",new Date(e.createdAt).toLocaleString("zh-CN")]}),t=[e.join(",")].concat(h(n.map(function(e){return e.join(",")}))).join("\n");o().setClipboardData({data:t,success:function(){o().showToast({title:"\u6570\u636e\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f",icon:"success"})}})}else o().showToast({title:"\u6682\u65e0\u6570\u636e",icon:"none"})},k=null!==w&&void 0!==w&&w.typeDistribution?Object.entries(w.typeDistribution).map(function(e){var n=g(e,2),t=n[0],r=n[1];return{name:t,value:r}}):[],C=null!==w&&void 0!==w&&w.genderDistribution?Object.entries(w.genderDistribution).map(function(e){var n=g(e,2),t=n[0],r=n[1];return{name:"male"===t?"\u7537":"\u5973",value:r}}):[];return(0,d.jsx)(a.BM,{className:"admin-page",scrollY:!0,children:(0,d.jsxs)(a.Ss,{className:"admin-container",children:[(0,d.jsx)(a.Ss,{className:"page-header",children:(0,d.jsxs)(a.Ss,{className:"header-top",children:[(0,d.jsxs)(a.Ss,{children:[(0,d.jsx)(a.EY,{className:"page-title",children:"\u7ba1\u7406\u540e\u53f0"}),(0,d.jsx)(a.EY,{className:"page-subtitle",children:"\u6570\u636e\u7edf\u8ba1\u4e0e\u5206\u6790"})]}),(0,d.jsxs)(a.Ss,{className:"admin-info",children:[(0,d.jsx)(a.EY,{className:"admin-name",children:(null===f||void 0===f?void 0:f.username)||"\u7ba1\u7406\u5458"}),(0,d.jsx)(u.$,{onClick:Y,variant:"outline",className:"logout-btn",children:"\u9000\u51fa"})]})]})}),(0,d.jsxs)(a.Ss,{className:"stats-grid",children:[(0,d.jsxs)(l.Zp,{children:[(0,d.jsx)(l.aR,{children:(0,d.jsx)(l.ZB,{children:"\u603b\u6d4b\u8bc4\u6570"})}),(0,d.jsx)(l.Wu,{children:(0,d.jsx)(a.EY,{className:"stat-value",children:(null===w||void 0===w?void 0:w.totalAssessments)||0})})]}),(0,d.jsxs)(l.Zp,{children:[(0,d.jsx)(l.aR,{children:(0,d.jsx)(l.ZB,{children:"\u4eca\u65e5\u65b0\u589e"})}),(0,d.jsx)(l.Wu,{children:(0,d.jsx)(a.EY,{className:"stat-value",children:(null===w||void 0===w?void 0:w.todayAssessments)||0})})]}),(0,d.jsxs)(l.Zp,{children:[(0,d.jsx)(l.aR,{children:(0,d.jsx)(l.ZB,{children:"\u7528\u6237\u603b\u6570"})}),(0,d.jsx)(l.Wu,{children:(0,d.jsx)(a.EY,{className:"stat-value",children:(null===w||void 0===w?void 0:w.totalUsers)||0})})]})]}),k.length>0&&(0,d.jsxs)(l.Zp,{children:[(0,d.jsx)(l.aR,{children:(0,d.jsx)(l.ZB,{children:"\u4f53\u8d28\u7c7b\u578b\u5206\u5e03"})}),(0,d.jsx)(l.Wu,{children:(0,d.jsx)(a.Ss,{className:"distribution-list",children:k.map(function(e,n){return(0,d.jsxs)(a.Ss,{className:"distribution-item",children:[(0,d.jsx)(a.EY,{className:"distribution-name",children:e.name}),(0,d.jsx)(a.Ss,{className:"distribution-bar-wrapper",children:(0,d.jsx)(a.Ss,{className:"distribution-bar",style:{width:"".concat(e.value/((null===w||void 0===w?void 0:w.totalAssessments)||1)*100,"%")}})}),(0,d.jsx)(a.EY,{className:"distribution-value",children:e.value})]},n)})})})]}),C.length>0&&(0,d.jsxs)(l.Zp,{children:[(0,d.jsx)(l.aR,{children:(0,d.jsx)(l.ZB,{children:"\u6027\u522b\u5206\u5e03"})}),(0,d.jsx)(l.Wu,{children:(0,d.jsx)(a.Ss,{className:"gender-grid",children:C.map(function(e,n){return(0,d.jsxs)(a.Ss,{className:"gender-item",children:[(0,d.jsx)(a.EY,{className:"gender-name",children:e.name}),(0,d.jsx)(a.EY,{className:"gender-value",children:e.value})]},n)})})})]}),(0,d.jsxs)(l.Zp,{children:[(0,d.jsx)(l.aR,{children:(0,d.jsx)(l.ZB,{children:"\u6570\u636e\u7ba1\u7406"})}),(0,d.jsx)(l.Wu,{children:(0,d.jsx)(u.$,{onClick:Z,variant:"outline",children:"\u5bfc\u51faCSV\u6570\u636e"})})]}),O&&O.length>0&&(0,d.jsxs)(l.Zp,{children:[(0,d.jsx)(l.aR,{children:(0,d.jsx)(l.ZB,{children:"\u6700\u8fd1\u6d4b\u8bc4\u8bb0\u5f55"})}),(0,d.jsx)(l.Wu,{children:(0,d.jsx)(a.Ss,{className:"assessments-list",children:O.slice(0,10).map(function(e){return(0,d.jsx)(a.Ss,{className:"assessment-item",children:(0,d.jsxs)(a.Ss,{className:"assessment-info",children:[(0,d.jsx)(a.EY,{className:"assessment-type",children:e.primaryType}),(0,d.jsxs)(a.EY,{className:"assessment-meta",children:[e.age,"\u5c81 \xb7 ","male"===e.gender?"\u7537":"\u5973"," \xb7 ",new Date(e.createdAt).toLocaleDateString()]})]})},e.id)})})})]})]})})}var O={navigationBarTitleText:"\u7ba1\u7406\u540e\u53f0"};Page((0,r.createPageConfig)(E,"pages/admin/index",{root:{cn:[]}},O||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[907,96,76],function(){return n(7299)});e.O()}]);